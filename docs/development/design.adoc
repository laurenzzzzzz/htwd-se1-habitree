= Design: {project-name}
Laurenz Born <laurenz.born@stud.htw-dresden.de>; Alexander Chlebowski <alexander.chlebowski@stud.htw-dresden.de>; Leonhard Hermann <leonhard.hermann@stud.htw-dresden.de>; Johann Schmidt <johann.schmidt@stud.htw-dresden.de>; Kimi Jerke <kimi.jerke@stud.htw-dresden.de>; Jannes Lehmann <s86317@htw-dresden.de>
{localdatetime}
include::../_includes/default-attributes.inc.adoc[]

== Zweck
Dieses Dokument beschreibt wesentliche Entwurfsentscheidungen auf Ebene der Komponenten und Module. Diese dienen als Vorgabe für die Implementierung und erleichtern das Systemverständnis.

//kein Plan ob das hier rein muss sowas

//== Designentscheidungen nach Komponenten
//=== Authentifizierung & Sessions
//* **Automatisches Wiederanmelden:** Beim Start prüft der AuthProvider, ob ein gespeichertes Token im SecureStore liegt. Ist es noch gültig, bleibt die Sitzung aktiv, anderenfalls erscheint direkt der Login-Screen.
//* **Token erneuern:** Es gibt nur ein Token. Läuft er ab, meldet sich der Nutzer erneut an. Damit bleibt die Backend-Logik überschaubar und wir müssen keine weiteren Token-Typen pflegen.

//=== Tagesplan & Habitlisten
//* **Optimistic Updates:** `useHabitsController` setzt den UI-Status sofort auf „erledigt“, bevor `POST /habits/{id}/entries` abgeschlossen ist. Schlägt der Request fehl, wird der lokale Zustand zurückgesetzt. Somit sieht der Nutzer direkt dass ein Habit erledigt ist, statt auf eine Server-Antwort zu warten. Dies erhöht die wahrgenommene Performance der App.
//* **Sortierung im Client:** Die Habits werden clientseitig nach Startzeit sortiert, damit verschiedene Listen (heute, Archiv, Filter) ohne zusätzliche Backend-Routen möglich sind und UI-Anpassungen ohne Backend-Deployment getestet werden können.

//=== Offline-Stand
//* **Gespeicherte Tokens:** Derzeit schreibt nur `SecureStoreAuthRepository` die Authentifizierungsdaten verschlüsselt auf das Gerät. Habit-Listen werden ausschließlich live vom Server geladen; Caching ist als zukünftige Erweiterung markiert.

//=== UI-Konzepte
//* **Controller-Hooks:** Jeder Screen nutzt eigene Hooks wie `useHabitsController`. Diese halten ihren Zustand selbst, daher brauchen wir keinen globalen Store bzw. eine zentrale Datensammelstelle, auf die jede Komponente zugreifen müsste. Änderungen passieren direkt im jeweiligen Screen und bleiben dadurch überschaubar.

//* **Theming:** ThemedView/ThemedText nutzen presentation/styles/colors.ts, sodass alle Screens dieselben Farbwerte verwenden, UI-Änderungen (z. B. neue Palette oder Dark Mode) nur an einer Stelle angepasst werden müssen und keine Komponente eigene Farben pflegt.


== Ausgewählte Sichten
=== Sequenzdiagramme mit User Stories:

==== Registrierung (US #250)

**User Story**  
Als neuer Nutzer möchte ich ein Konto erstellen können, um die App nutzen zu können.

[mermaid]
....
include::../development/plantuml/sequenzdiagramme.md[lines=66..104]
....

==== Login (US #250)

**User Story**  
Als Nutzer möchte ich mich anmelden können, um Zugriff auf meine persönlichen Habits zu erhalten.

[mermaid]
....
include::../development/plantuml/sequenzdiagramme.md[lines=19..55]
....

==== Logout (US #250)

**User Story**  
Als Nutzer möchte ich mich ausloggen können, um mein Konto zu schützen.

[mermaid]
....
include::../development/plantuml/sequenzdiagramme.md[lines=115..122]
....

==== Habit erstellen (US #92/ US #279 / US #280)

**User Story**  
Als Nutzer möchte ich ein neues Habit erstellen können, damit ich meine Ziele strukturiert planen kann.

[mermaid]
....
include::../development/plantuml/sequenzdiagramme.md[lines=133..163]
....

==== Habit abhaken (US #93/ US #299)

**User Story**  
Als Nutzer möchte ich ein Habit abhaken können, um meinen täglichen Fortschritt zu dokumentieren.

[mermaid]
....    
include::../development/plantuml/sequenzdiagramme.md[lines=174..192]
....

==== Habit-Liste abrufen (US #93)

**User Story**  
Als Nutzer möchte ich eine Übersicht meiner Habits sehen können, um meinen Fortschritt zu verfolgen.

[mermaid]
....
include::../development/plantuml/sequenzdiagramme.md[lines=203..221]
....


//
//**Die Links zu der Dokumentation und Visualisierung für alle unserer Sequenzdiagramme mit den passenden User Stories:**//

//link:plantuml/Sequenzdiagramm_Login.plantuml[Link zu den Login Sequenzdiagramm]

//link:plantuml/Sequenzdiagramm_Registrierung.plantuml[Link zu den Registrierung Sequenzdiagramm]

//link:plantuml/sequenzdiagramme.md[Link zu den restlichen Sequenzdiagramme]


== Schnittstellen
// Dokumentation oder Verweise auf Schnittstellen, z.B REST-APIs

* **REST-API (OpenAPI 3.0):** Die Spezifikation liegt in `docs/architecture/openapi.yaml`. Für eine interaktive Ansicht kann z. B. Redoc gestartet werden (`npx redoc-cli serve docs/architecture/openapi.yaml`) oder Swagger UI mit diesem Pfad verwendet werden.

//[cols="1,1,2,2",options="header"]
//|===
//| Endpoint | Methode | Anfrage (wichtige Felder) | Antwort / Hinweise
//| `/auth/register` | POST | `{ email, password, username }` | 201 + Token + Nutzerdaten
//| `/auth/login` | POST | `{ email, password }` | 200 + Token + Nutzerdaten
//| `/auth/password` | PUT | `{ oldPassword, newPassword }` | 200 + Erfolg (Passwort geändert)
//| `/habits` | GET | Header `Authorization: Bearer <Token>` | Liste aller aktiven (nicht geernteten) Habits
//| `/habits` | POST | `{ name, description, frequency, startDate, time, ... }` | 201 + neu angelegtes Habit
//| `/habits/{id}` | PUT | Felder wie POST | 200 + aktualisiertes Habit
//| `/habits/{id}` | DELETE | — | 200 + Erfolg
//| `/habits/{id}/toggle` | PUT | `{ date }` | 200 + Habit-Status für Datum umgeschaltet
//| `/habits/today` | GET | — | Habits, die heute fällig sind (inkl. Entry)
//| `/habits/{id}/grow` | PUT | — | 200 + Habitstatus wird "wachsend"
//| `/habits/{id}/harvest` | PUT | — | 200 + Habitstatus wird "geerntet"
//| `/user/status` | GET | — | Login-Status + Nutzerdaten
//| `/user/streak` | GET | — | Current Streak & Max Streak
//| `/user/username` | PUT | `{ username }` | 200 + aktualisierte Nutzerdaten
//| `/quotes` | GET | — | Liste aller Zitate
//|===

== Datenmodell

[plantuml]
....
include::plantuml/datenbank-beziehungen.plantuml[]
....

//link:plantuml/datenbank-beziehungen.plantuml[Link zu der Datenbank Beziehung]

== Umsetzungen und Erweiterungen der Architektur durch User Stories

=== User Story 1: Automatische Anzeige des Tagesplans

[quote]

---

Als Tom möchte ich, dass mir beim Öffnen der App automatisch mein Tagesplan angezeigt wird,
damit ich sofort weiß, was als Nächstes ansteht.

---

==== Beschreibung
Diese User Story beschreibt, dass beim Öffnen der App automatisch der Tagesplan für den aktuellen Tag angezeigt wird.
Es sollen nur Habits berücksichtigt werden, die für heute geplant sind und eine Startzeit besitzen.
Der Nutzer soll unmittelbar nach dem App-Start eine chronologische Übersicht seiner heutigen Gewohnheiten erhalten.

==== Akzeptanzkriterien

* Die App zeigt den Tagesplan direkt nach dem Öffnen an.
* Es werden nur Habits für den aktuellen Tag angezeigt.
* Es werden nur Habits berücksichtigt, die eine Startzeit besitzen.
* Wenn keine anstehenden Habits vorhanden sind, erscheint kein Tagesplan-Bereich.

==== Zerlegung in Tasks

* Task #170: Tagesplan bei App-Start anzeigen
* Task #171: Filterlogik für geplante Habits
* Task #172: Design der Tagesplan-Anzeige

==== Sequenzdiagramm:

[mermaid]
....
include::../development/plantuml/Sequenzdiagramm_AutomatischeAnzeige_Tagesplan.md[lines=2..31]
....

//link:plantuml/Sequenzdiagramm_AutomatischeAnzeige_Tagesplan.md[Link zu den passenden Sequenzdiagramm]

== Versions- und Konfigurationsmanagement

=== Repository-Struktur

* **Main Branch**: `main` - Produktionsbereiter Code
* **Feature Branches**: Temporäre Branches für neue Features
* **Bugfix Branches**: Temporäre Branches für Fehlerbehebungen

=== Branch-Naming Convention

* `feature/<kurze-beschreibung>` (z.B. `feature/add-streak-tracking`)
* `bugfix/<kurze-beschreibung>` (z.B. `bugfix/fix-login-error`)
* feature sowie bugfix branches werden nach merge gelöscht


=== Commit Message Format

----
<type> kurze beschreibung
----

**Types:**

* `Update`: bestehendes Dokument aktualisiert oder bestehenden Code aktualisieren ohne neue Funktionen hinzuzufügen
* `Add`: neues Feature oder neue Datei hinzufügen, neue Bereiche in der Dokumentation erstellen
* `Bugfix`: Fehlerbehebung
* `Delete`: Datei oder Code entfernen, bestehnede Bereiche in der Dokumentation löschen

=== GitHub Workflow

==== Branch erstellen

[source,bash]
----
git checkout main
git pull origin main

# Neuen Feature Branch erstellen
git checkout -b feature/mein-neues-feature
----

==== Entwicklung & Commits

[source,bash]
----
# Änderungen staged
git add .
git commit -m "add habit streak visualization"
----

==== Push & Pull Request erstellen

[source,bash]
----
# Branch pushen
git push origin feature/mein-neues-feature

# Pull Request auf GitHub erstellen
----

==== Code Review

* **Selbstreview**: vor Pull Request neue Feature selbst prüfen
* **Mindestens 1 Reviewer** muss den Code prüfen
* **Review-Kriterien**: Code-Qualität, Lesbarkeit
* **Änderungen umsetzen**: Feedback aus Review einarbeiten

==== Merge

* **Squash and Merge** 
* **Delete Branch** nach erfolgreichem Merge
* **Main aktualisieren**: Lokalen Main Branch aktualisieren

== Link zum Repo
GitHub Repository: https://github.com/laurenzzzzzz/htwd-se1-habitree
